var cov_1xyvq0qckk=function(){var path='/Users/andeladeveloper/Documents/Projects/thorin-cfh/config/socket/socket.js',hash='7d8afb40b615719a49671d30535d51408f6504e5',Function=function(){}.constructor,global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/Users/andeladeveloper/Documents/Projects/thorin-cfh/config/socket/socket.js',statementMap:{'0':{start:{line:1,column:11},end:{line:1,column:28}},'1':{start:{line:2,column:13},end:{line:2,column:32}},'2':{start:{line:3,column:0},end:{line:3,column:51}},'3':{start:{line:4,column:15},end:{line:4,column:34}},'4':{start:{line:5,column:11},end:{line:5,column:33}},'5':{start:{line:7,column:14},end:{line:7,column:76}},'6':{start:{line:9,column:12},end:{line:9,column:75}},'7':{start:{line:11,column:0},end:{line:232,column:2}},'8':{start:{line:14,column:17},end:{line:14,column:19}},'9':{start:{line:15,column:19},end:{line:15,column:21}},'10':{start:{line:16,column:28},end:{line:16,column:30}},'11':{start:{line:17,column:15},end:{line:17,column:16}},'12':{start:{line:19,column:2},end:{line:76,column:5}},'13':{start:{line:20,column:4},end:{line:20,column:43}},'14':{start:{line:21,column:4},end:{line:21,column:39}},'15':{start:{line:23,column:4},end:{line:30,column:7}},'16':{start:{line:24,column:6},end:{line:24,column:43}},'17':{start:{line:25,column:6},end:{line:29,column:7}},'18':{start:{line:26,column:8},end:{line:26,column:64}},'19':{start:{line:28,column:8},end:{line:28,column:94}},'20':{start:{line:32,column:4},end:{line:38,column:7}},'21':{start:{line:33,column:6},end:{line:37,column:7}},'22':{start:{line:34,column:8},end:{line:34,column:65}},'23':{start:{line:36,column:8},end:{line:36,column:97}},'24':{start:{line:40,column:4},end:{line:44,column:7}},'25':{start:{line:41,column:6},end:{line:43,column:7}},'26':{start:{line:42,column:8},end:{line:42,column:30}},'27':{start:{line:46,column:4},end:{line:49,column:7}},'28':{start:{line:47,column:6},end:{line:47,column:23}},'29':{start:{line:48,column:6},end:{line:48,column:28}},'30':{start:{line:51,column:4},end:{line:66,column:7}},'31':{start:{line:52,column:6},end:{line:65,column:7}},'32':{start:{line:53,column:23},end:{line:53,column:46}},'33':{start:{line:54,column:8},end:{line:54,column:80}},'34':{start:{line:55,column:8},end:{line:64,column:9}},'35':{start:{line:57,column:10},end:{line:61,column:13}},'36':{start:{line:58,column:12},end:{line:60,column:13}},'37':{start:{line:59,column:14},end:{line:59,column:57}},'38':{start:{line:62,column:10},end:{line:62,column:33}},'39':{start:{line:63,column:10},end:{line:63,column:59}},'40':{start:{line:68,column:4},end:{line:70,column:7}},'41':{start:{line:69,column:6},end:{line:69,column:23}},'42':{start:{line:72,column:4},end:{line:75,column:7}},'43':{start:{line:73,column:6},end:{line:73,column:68}},'44':{start:{line:74,column:6},end:{line:74,column:23}},'45':{start:{line:78,column:17},end:{line:107,column:3}},'46':{start:{line:79,column:17},end:{line:79,column:35}},'47':{start:{line:80,column:4},end:{line:80,column:22}},'48':{start:{line:81,column:4},end:{line:81,column:53}},'49':{start:{line:82,column:4},end:{line:106,column:5}},'50':{start:{line:83,column:6},end:{line:100,column:9}},'51':{start:{line:86,column:8},end:{line:89,column:9}},'52':{start:{line:87,column:10},end:{line:87,column:33}},'53':{start:{line:88,column:10},end:{line:88,column:21}},'54':{start:{line:90,column:8},end:{line:98,column:9}},'55':{start:{line:92,column:10},end:{line:92,column:36}},'56':{start:{line:93,column:10},end:{line:93,column:66}},'57':{start:{line:95,column:10},end:{line:95,column:38}},'58':{start:{line:96,column:10},end:{line:96,column:45}},'59':{start:{line:97,column:10},end:{line:97,column:81}},'60':{start:{line:99,column:8},end:{line:99,column:60}},'61':{start:{line:103,column:6},end:{line:103,column:32}},'62':{start:{line:104,column:6},end:{line:104,column:62}},'63':{start:{line:105,column:6},end:{line:105,column:58}},'64':{start:{line:109,column:16},end:{line:150,column:3}},'65':{start:{line:110,column:4},end:{line:110,column:44}},'66':{start:{line:111,column:4},end:{line:111,column:43}},'67':{start:{line:112,column:4},end:{line:112,column:64}},'68':{start:{line:113,column:4},end:{line:148,column:5}},'69':{start:{line:114,column:6},end:{line:114,column:53}},'70':{start:{line:115,column:17},end:{line:115,column:42}},'71':{start:{line:121,column:6},end:{line:139,column:7}},'72':{start:{line:124,column:8},end:{line:124,column:63}},'73':{start:{line:125,column:8},end:{line:125,column:37}},'74':{start:{line:126,column:8},end:{line:126,column:34}},'75':{start:{line:127,column:8},end:{line:127,column:33}},'76':{start:{line:128,column:8},end:{line:128,column:36}},'77':{start:{line:129,column:8},end:{line:129,column:34}},'78':{start:{line:130,column:8},end:{line:130,column:32}},'79':{start:{line:131,column:8},end:{line:131,column:26}},'80':{start:{line:132,column:8},end:{line:132,column:71}},'81':{start:{line:133,column:8},end:{line:136,column:9}},'82':{start:{line:134,column:10},end:{line:134,column:38}},'83':{start:{line:135,column:10},end:{line:135,column:29}},'84':{start:{line:142,column:6},end:{line:142,column:69}},'85':{start:{line:143,column:6},end:{line:147,column:7}},'86':{start:{line:144,column:8},end:{line:144,column:45}},'87':{start:{line:146,column:8},end:{line:146,column:32}},'88':{start:{line:152,column:17},end:{line:184,column:3}},'89':{start:{line:154,column:4},end:{line:183,column:5}},'90':{start:{line:155,column:6},end:{line:155,column:18}},'91':{start:{line:156,column:22},end:{line:156,column:39}},'92':{start:{line:157,column:6},end:{line:157,column:37}},'93':{start:{line:158,column:6},end:{line:158,column:35}},'94':{start:{line:159,column:6},end:{line:159,column:32}},'95':{start:{line:160,column:6},end:{line:160,column:30}},'96':{start:{line:161,column:6},end:{line:161,column:37}},'97':{start:{line:162,column:6},end:{line:162,column:31}},'98':{start:{line:163,column:6},end:{line:163,column:34}},'99':{start:{line:164,column:6},end:{line:164,column:73}},'100':{start:{line:165,column:6},end:{line:165,column:32}},'101':{start:{line:166,column:6},end:{line:166,column:30}},'102':{start:{line:167,column:6},end:{line:167,column:24}},'103':{start:{line:169,column:6},end:{line:169,column:36}},'104':{start:{line:170,column:6},end:{line:170,column:35}},'105':{start:{line:171,column:6},end:{line:171,column:32}},'106':{start:{line:172,column:6},end:{line:172,column:59}},'107':{start:{line:173,column:6},end:{line:173,column:31}},'108':{start:{line:174,column:6},end:{line:174,column:34}},'109':{start:{line:175,column:6},end:{line:175,column:32}},'110':{start:{line:176,column:6},end:{line:176,column:30}},'111':{start:{line:177,column:6},end:{line:177,column:24}},'112':{start:{line:178,column:6},end:{line:178,column:69}},'113':{start:{line:179,column:6},end:{line:182,column:7}},'114':{start:{line:180,column:8},end:{line:180,column:36}},'115':{start:{line:181,column:8},end:{line:181,column:27}},'116':{start:{line:186,column:30},end:{line:209,column:3}},'117':{start:{line:187,column:23},end:{line:187,column:28}},'118':{start:{line:188,column:21},end:{line:188,column:23}},'119':{start:{line:190,column:4},end:{line:198,column:5}},'120':{start:{line:191,column:6},end:{line:191,column:22}},'121':{start:{line:192,column:6},end:{line:194,column:7}},'122':{start:{line:193,column:8},end:{line:193,column:68}},'123':{start:{line:195,column:6},end:{line:197,column:7}},'124':{start:{line:196,column:8},end:{line:196,column:28}},'125':{start:{line:199,column:4},end:{line:199,column:64}},'126':{start:{line:200,column:15},end:{line:200,column:38}},'127':{start:{line:201,column:4},end:{line:201,column:33}},'128':{start:{line:202,column:4},end:{line:202,column:30}},'129':{start:{line:203,column:4},end:{line:203,column:32}},'130':{start:{line:204,column:4},end:{line:204,column:29}},'131':{start:{line:205,column:4},end:{line:205,column:32}},'132':{start:{line:206,column:4},end:{line:206,column:30}},'133':{start:{line:207,column:4},end:{line:207,column:28}},'134':{start:{line:208,column:4},end:{line:208,column:22}},'135':{start:{line:211,column:17},end:{line:230,column:3}},'136':{start:{line:212,column:4},end:{line:212,column:46}},'137':{start:{line:213,column:4},end:{line:228,column:5}},'138':{start:{line:214,column:17},end:{line:214,column:40}},'139':{start:{line:215,column:6},end:{line:215,column:57}},'140':{start:{line:216,column:6},end:{line:216,column:35}},'141':{start:{line:217,column:6},end:{line:227,column:7}},'142':{start:{line:219,column:8},end:{line:219,column:37}},'143':{start:{line:221,column:8},end:{line:221,column:33}},'144':{start:{line:222,column:8},end:{line:224,column:9}},'145':{start:{line:223,column:10},end:{line:223,column:54}},'146':{start:{line:225,column:8},end:{line:225,column:24}},'147':{start:{line:226,column:8},end:{line:226,column:39}},'148':{start:{line:229,column:4},end:{line:229,column:32}}},fnMap:{'0':{name:'(anonymous_0)',decl:{start:{line:11,column:17},end:{line:11,column:18}},loc:{start:{line:11,column:30},end:{line:232,column:1}},line:11},'1':{name:'(anonymous_1)',decl:{start:{line:19,column:30},end:{line:19,column:31}},loc:{start:{line:19,column:48},end:{line:76,column:3}},line:19},'2':{name:'(anonymous_2)',decl:{start:{line:23,column:27},end:{line:23,column:28}},loc:{start:{line:23,column:42},end:{line:30,column:5}},line:23},'3':{name:'(anonymous_3)',decl:{start:{line:32,column:29},end:{line:32,column:30}},loc:{start:{line:32,column:44},end:{line:38,column:5}},line:32},'4':{name:'(anonymous_4)',decl:{start:{line:40,column:26},end:{line:40,column:27}},loc:{start:{line:40,column:41},end:{line:44,column:5}},line:40},'5':{name:'(anonymous_5)',decl:{start:{line:46,column:29},end:{line:46,column:30}},loc:{start:{line:46,column:44},end:{line:49,column:5}},line:46},'6':{name:'(anonymous_6)',decl:{start:{line:51,column:27},end:{line:51,column:28}},loc:{start:{line:51,column:38},end:{line:66,column:5}},line:51},'7':{name:'(anonymous_7)',decl:{start:{line:57,column:38},end:{line:57,column:39}},loc:{start:{line:57,column:59},end:{line:61,column:11}},line:57},'8':{name:'(anonymous_8)',decl:{start:{line:68,column:27},end:{line:68,column:28}},loc:{start:{line:68,column:38},end:{line:70,column:5}},line:68},'9':{name:'(anonymous_9)',decl:{start:{line:72,column:28},end:{line:72,column:29}},loc:{start:{line:72,column:38},end:{line:75,column:5}},line:72},'10':{name:'(anonymous_10)',decl:{start:{line:78,column:17},end:{line:78,column:18}},loc:{start:{line:78,column:39},end:{line:107,column:3}},line:78},'11':{name:'(anonymous_11)',decl:{start:{line:85,column:14},end:{line:85,column:15}},loc:{start:{line:85,column:34},end:{line:100,column:7}},line:85},'12':{name:'(anonymous_12)',decl:{start:{line:109,column:16},end:{line:109,column:17}},loc:{start:{line:109,column:70},end:{line:150,column:3}},line:109},'13':{name:'(anonymous_13)',decl:{start:{line:152,column:17},end:{line:152,column:18}},loc:{start:{line:152,column:41},end:{line:184,column:3}},line:152},'14':{name:'(anonymous_14)',decl:{start:{line:186,column:30},end:{line:186,column:31}},loc:{start:{line:186,column:54},end:{line:209,column:3}},line:186},'15':{name:'(anonymous_15)',decl:{start:{line:211,column:17},end:{line:211,column:18}},loc:{start:{line:211,column:34},end:{line:230,column:3}},line:211}},branchMap:{'0':{loc:{start:{line:25,column:6},end:{line:29,column:7}},type:'if',locations:[{start:{line:25,column:6},end:{line:29,column:7}},{start:{line:25,column:6},end:{line:29,column:7}}],line:25},'1':{loc:{start:{line:33,column:6},end:{line:37,column:7}},type:'if',locations:[{start:{line:33,column:6},end:{line:37,column:7}},{start:{line:33,column:6},end:{line:37,column:7}}],line:33},'2':{loc:{start:{line:41,column:6},end:{line:43,column:7}},type:'if',locations:[{start:{line:41,column:6},end:{line:43,column:7}},{start:{line:41,column:6},end:{line:43,column:7}}],line:41},'3':{loc:{start:{line:52,column:6},end:{line:65,column:7}},type:'if',locations:[{start:{line:52,column:6},end:{line:65,column:7}},{start:{line:52,column:6},end:{line:65,column:7}}],line:52},'4':{loc:{start:{line:55,column:8},end:{line:64,column:9}},type:'if',locations:[{start:{line:55,column:8},end:{line:64,column:9}},{start:{line:55,column:8},end:{line:64,column:9}}],line:55},'5':{loc:{start:{line:58,column:12},end:{line:60,column:13}},type:'if',locations:[{start:{line:58,column:12},end:{line:60,column:13}},{start:{line:58,column:12},end:{line:60,column:13}}],line:58},'6':{loc:{start:{line:80,column:11},end:{line:80,column:21}},type:'binary-expr',locations:[{start:{line:80,column:11},end:{line:80,column:15}},{start:{line:80,column:19},end:{line:80,column:21}}],line:80},'7':{loc:{start:{line:81,column:20},end:{line:81,column:52}},type:'binary-expr',locations:[{start:{line:81,column:20},end:{line:81,column:31}},{start:{line:81,column:35},end:{line:81,column:52}}],line:81},'8':{loc:{start:{line:82,column:4},end:{line:106,column:5}},type:'if',locations:[{start:{line:82,column:4},end:{line:106,column:5}},{start:{line:82,column:4},end:{line:106,column:5}}],line:82},'9':{loc:{start:{line:86,column:8},end:{line:89,column:9}},type:'if',locations:[{start:{line:86,column:8},end:{line:89,column:9}},{start:{line:86,column:8},end:{line:89,column:9}}],line:86},'10':{loc:{start:{line:90,column:8},end:{line:98,column:9}},type:'if',locations:[{start:{line:90,column:8},end:{line:98,column:9}},{start:{line:90,column:8},end:{line:98,column:9}}],line:90},'11':{loc:{start:{line:96,column:27},end:{line:96,column:44}},type:'binary-expr',locations:[{start:{line:96,column:27},end:{line:96,column:39}},{start:{line:96,column:43},end:{line:96,column:44}}],line:96},'12':{loc:{start:{line:97,column:26},end:{line:97,column:80}},type:'binary-expr',locations:[{start:{line:97,column:26},end:{line:97,column:37}},{start:{line:97,column:41},end:{line:97,column:80}}],line:97},'13':{loc:{start:{line:110,column:22},end:{line:110,column:43}},type:'binary-expr',locations:[{start:{line:110,column:22},end:{line:110,column:37}},{start:{line:110,column:41},end:{line:110,column:43}}],line:110},'14':{loc:{start:{line:111,column:20},end:{line:111,column:42}},type:'binary-expr',locations:[{start:{line:111,column:20},end:{line:111,column:33}},{start:{line:111,column:37},end:{line:111,column:42}}],line:111},'15':{loc:{start:{line:113,column:4},end:{line:148,column:5}},type:'if',locations:[{start:{line:113,column:4},end:{line:148,column:5}},{start:{line:113,column:4},end:{line:148,column:5}}],line:113},'16':{loc:{start:{line:113,column:8},end:{line:113,column:59}},type:'binary-expr',locations:[{start:{line:113,column:8},end:{line:113,column:30}},{start:{line:113,column:34},end:{line:113,column:59}}],line:113},'17':{loc:{start:{line:121,column:6},end:{line:139,column:7}},type:'if',locations:[{start:{line:121,column:6},end:{line:139,column:7}},{start:{line:121,column:6},end:{line:139,column:7}}],line:121},'18':{loc:{start:{line:121,column:10},end:{line:122,column:48}},type:'binary-expr',locations:[{start:{line:121,column:10},end:{line:121,column:43}},{start:{line:121,column:48},end:{line:121,column:68}},{start:{line:122,column:8},end:{line:122,column:47}}],line:121},'19':{loc:{start:{line:133,column:8},end:{line:136,column:9}},type:'if',locations:[{start:{line:133,column:8},end:{line:136,column:9}},{start:{line:133,column:8},end:{line:136,column:9}}],line:133},'20':{loc:{start:{line:143,column:6},end:{line:147,column:7}},type:'if',locations:[{start:{line:143,column:6},end:{line:147,column:7}},{start:{line:143,column:6},end:{line:147,column:7}}],line:143},'21':{loc:{start:{line:154,column:4},end:{line:183,column:5}},type:'if',locations:[{start:{line:154,column:4},end:{line:183,column:5}},{start:{line:154,column:4},end:{line:183,column:5}}],line:154},'22':{loc:{start:{line:179,column:6},end:{line:182,column:7}},type:'if',locations:[{start:{line:179,column:6},end:{line:182,column:7}},{start:{line:179,column:6},end:{line:182,column:7}}],line:179},'23':{loc:{start:{line:195,column:6},end:{line:197,column:7}},type:'if',locations:[{start:{line:195,column:6},end:{line:197,column:7}},{start:{line:195,column:6},end:{line:197,column:7}}],line:195},'24':{loc:{start:{line:195,column:10},end:{line:195,column:62}},type:'binary-expr',locations:[{start:{line:195,column:10},end:{line:195,column:31}},{start:{line:195,column:35},end:{line:195,column:62}}],line:195},'25':{loc:{start:{line:213,column:4},end:{line:228,column:5}},type:'if',locations:[{start:{line:213,column:4},end:{line:228,column:5}},{start:{line:213,column:4},end:{line:228,column:5}}],line:213},'26':{loc:{start:{line:217,column:6},end:{line:227,column:7}},type:'if',locations:[{start:{line:217,column:6},end:{line:227,column:7}},{start:{line:217,column:6},end:{line:227,column:7}}],line:217},'27':{loc:{start:{line:217,column:10},end:{line:218,column:52}},type:'binary-expr',locations:[{start:{line:217,column:10},end:{line:217,column:43}},{start:{line:218,column:8},end:{line:218,column:52}}],line:217}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0,'35':0,'36':0,'37':0,'38':0,'39':0,'40':0,'41':0,'42':0,'43':0,'44':0,'45':0,'46':0,'47':0,'48':0,'49':0,'50':0,'51':0,'52':0,'53':0,'54':0,'55':0,'56':0,'57':0,'58':0,'59':0,'60':0,'61':0,'62':0,'63':0,'64':0,'65':0,'66':0,'67':0,'68':0,'69':0,'70':0,'71':0,'72':0,'73':0,'74':0,'75':0,'76':0,'77':0,'78':0,'79':0,'80':0,'81':0,'82':0,'83':0,'84':0,'85':0,'86':0,'87':0,'88':0,'89':0,'90':0,'91':0,'92':0,'93':0,'94':0,'95':0,'96':0,'97':0,'98':0,'99':0,'100':0,'101':0,'102':0,'103':0,'104':0,'105':0,'106':0,'107':0,'108':0,'109':0,'110':0,'111':0,'112':0,'113':0,'114':0,'115':0,'116':0,'117':0,'118':0,'119':0,'120':0,'121':0,'122':0,'123':0,'124':0,'125':0,'126':0,'127':0,'128':0,'129':0,'130':0,'131':0,'132':0,'133':0,'134':0,'135':0,'136':0,'137':0,'138':0,'139':0,'140':0,'141':0,'142':0,'143':0,'144':0,'145':0,'146':0,'147':0,'148':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0],'4':[0,0],'5':[0,0],'6':[0,0],'7':[0,0],'8':[0,0],'9':[0,0],'10':[0,0],'11':[0,0],'12':[0,0],'13':[0,0],'14':[0,0],'15':[0,0],'16':[0,0],'17':[0,0],'18':[0,0,0],'19':[0,0],'20':[0,0],'21':[0,0],'22':[0,0],'23':[0,0],'24':[0,0],'25':[0,0],'26':[0,0],'27':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var Game=(cov_1xyvq0qckk.s[0]++,require('./game'));var Player=(cov_1xyvq0qckk.s[1]++,require('./player'));cov_1xyvq0qckk.s[2]++;require("console-stamp")(console,"m/dd HH:MM:ss");var mongoose=(cov_1xyvq0qckk.s[3]++,require('mongoose'));var User=(cov_1xyvq0qckk.s[4]++,mongoose.model('User'));var avatars=(cov_1xyvq0qckk.s[5]++,require(__dirname+'/../../app/controllers/avatars.js').all());// Valid characters to use to generate random private game IDs
var chars=(cov_1xyvq0qckk.s[6]++,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz");cov_1xyvq0qckk.s[7]++;module.exports=function(io){cov_1xyvq0qckk.f[0]++;var game;var allGames=(cov_1xyvq0qckk.s[8]++,{});var allPlayers=(cov_1xyvq0qckk.s[9]++,{});var gamesNeedingPlayers=(cov_1xyvq0qckk.s[10]++,[]);var gameID=(cov_1xyvq0qckk.s[11]++,0);cov_1xyvq0qckk.s[12]++;io.sockets.on('connection',function(socket){cov_1xyvq0qckk.f[1]++;cov_1xyvq0qckk.s[13]++;console.log(socket.id+' Connected');cov_1xyvq0qckk.s[14]++;socket.emit('id',{id:socket.id});cov_1xyvq0qckk.s[15]++;socket.on('pickCards',function(data){cov_1xyvq0qckk.f[2]++;cov_1xyvq0qckk.s[16]++;console.log(socket.id,"picked",data);cov_1xyvq0qckk.s[17]++;if(allGames[socket.gameID]){cov_1xyvq0qckk.b[0][0]++;cov_1xyvq0qckk.s[18]++;allGames[socket.gameID].pickCards(data.cards,socket.id);}else{cov_1xyvq0qckk.b[0][1]++;cov_1xyvq0qckk.s[19]++;console.log('Received pickCard from',socket.id,'but game does not appear to exist!');}});cov_1xyvq0qckk.s[20]++;socket.on('pickWinning',function(data){cov_1xyvq0qckk.f[3]++;cov_1xyvq0qckk.s[21]++;if(allGames[socket.gameID]){cov_1xyvq0qckk.b[1][0]++;cov_1xyvq0qckk.s[22]++;allGames[socket.gameID].pickWinning(data.card,socket.id);}else{cov_1xyvq0qckk.b[1][1]++;cov_1xyvq0qckk.s[23]++;console.log('Received pickWinning from',socket.id,'but game does not appear to exist!');}});cov_1xyvq0qckk.s[24]++;socket.on('joinGame',function(data){cov_1xyvq0qckk.f[4]++;cov_1xyvq0qckk.s[25]++;if(!allPlayers[socket.id]){cov_1xyvq0qckk.b[2][0]++;cov_1xyvq0qckk.s[26]++;joinGame(socket,data);}else{cov_1xyvq0qckk.b[2][1]++;}});cov_1xyvq0qckk.s[27]++;socket.on('joinNewGame',function(data){cov_1xyvq0qckk.f[5]++;cov_1xyvq0qckk.s[28]++;exitGame(socket);cov_1xyvq0qckk.s[29]++;joinGame(socket,data);});cov_1xyvq0qckk.s[30]++;socket.on('startGame',function(){cov_1xyvq0qckk.f[6]++;cov_1xyvq0qckk.s[31]++;if(allGames[socket.gameID]){cov_1xyvq0qckk.b[3][0]++;var thisGame=(cov_1xyvq0qckk.s[32]++,allGames[socket.gameID]);cov_1xyvq0qckk.s[33]++;console.log('comparing',thisGame.players[0].socket.id,'with',socket.id);cov_1xyvq0qckk.s[34]++;if(thisGame.players.length>=thisGame.playerMinLimit){cov_1xyvq0qckk.b[4][0]++;cov_1xyvq0qckk.s[35]++;// Remove this game from gamesNeedingPlayers so new players can't join it.
gamesNeedingPlayers.forEach(function(game,index){cov_1xyvq0qckk.f[7]++;cov_1xyvq0qckk.s[36]++;if(game.gameID===socket.gameID){cov_1xyvq0qckk.b[5][0]++;cov_1xyvq0qckk.s[37]++;return gamesNeedingPlayers.splice(index,1);}else{cov_1xyvq0qckk.b[5][1]++;}});cov_1xyvq0qckk.s[38]++;thisGame.prepareGame();cov_1xyvq0qckk.s[39]++;thisGame.sendNotification('The game has begun!');}else{cov_1xyvq0qckk.b[4][1]++;}}else{cov_1xyvq0qckk.b[3][1]++;}});cov_1xyvq0qckk.s[40]++;socket.on('leaveGame',function(){cov_1xyvq0qckk.f[8]++;cov_1xyvq0qckk.s[41]++;exitGame(socket);});cov_1xyvq0qckk.s[42]++;socket.on('disconnect',function(){cov_1xyvq0qckk.f[9]++;cov_1xyvq0qckk.s[43]++;console.log('Rooms on Disconnect ',io.sockets.manager.rooms);cov_1xyvq0qckk.s[44]++;exitGame(socket);});});cov_1xyvq0qckk.s[45]++;var joinGame=function(socket,data){cov_1xyvq0qckk.f[10]++;var player=(cov_1xyvq0qckk.s[46]++,new Player(socket));cov_1xyvq0qckk.s[47]++;data=(cov_1xyvq0qckk.b[6][0]++,data)||(cov_1xyvq0qckk.b[6][1]++,{});cov_1xyvq0qckk.s[48]++;player.userID=(cov_1xyvq0qckk.b[7][0]++,data.userID)||(cov_1xyvq0qckk.b[7][1]++,'unauthenticated');cov_1xyvq0qckk.s[49]++;if(data.userID!=='unauthenticated'){cov_1xyvq0qckk.b[8][0]++;cov_1xyvq0qckk.s[50]++;User.findOne({_id:data.userID}).exec(function(err,user){cov_1xyvq0qckk.f[11]++;cov_1xyvq0qckk.s[51]++;if(err){cov_1xyvq0qckk.b[9][0]++;cov_1xyvq0qckk.s[52]++;console.log('err',err);cov_1xyvq0qckk.s[53]++;return err;// Hopefully this never happens.
}else{cov_1xyvq0qckk.b[9][1]++;}cov_1xyvq0qckk.s[54]++;if(!user){cov_1xyvq0qckk.b[10][0]++;cov_1xyvq0qckk.s[55]++;// If the user's ID isn't found (rare)
player.username='Guest';cov_1xyvq0qckk.s[56]++;player.avatar=avatars[Math.floor(Math.random()*4)+12];}else{cov_1xyvq0qckk.b[10][1]++;cov_1xyvq0qckk.s[57]++;player.username=user.name;cov_1xyvq0qckk.s[58]++;player.premium=(cov_1xyvq0qckk.b[11][0]++,user.premium)||(cov_1xyvq0qckk.b[11][1]++,0);cov_1xyvq0qckk.s[59]++;player.avatar=(cov_1xyvq0qckk.b[12][0]++,user.avatar)||(cov_1xyvq0qckk.b[12][1]++,avatars[Math.floor(Math.random()*4)+12]);}cov_1xyvq0qckk.s[60]++;getGame(player,socket,data.room,data.createPrivate);});}else{cov_1xyvq0qckk.b[8][1]++;cov_1xyvq0qckk.s[61]++;// If the user isn't authenticated (guest)
player.username='Guest';cov_1xyvq0qckk.s[62]++;player.avatar=avatars[Math.floor(Math.random()*4)+12];cov_1xyvq0qckk.s[63]++;getGame(player,socket,data.room,data.createPrivate);}};cov_1xyvq0qckk.s[64]++;var getGame=function(player,socket,requestedGameId,createPrivate){cov_1xyvq0qckk.f[12]++;cov_1xyvq0qckk.s[65]++;requestedGameId=(cov_1xyvq0qckk.b[13][0]++,requestedGameId)||(cov_1xyvq0qckk.b[13][1]++,'');cov_1xyvq0qckk.s[66]++;createPrivate=(cov_1xyvq0qckk.b[14][0]++,createPrivate)||(cov_1xyvq0qckk.b[14][1]++,false);cov_1xyvq0qckk.s[67]++;console.log(socket.id,'is requesting room',requestedGameId);cov_1xyvq0qckk.s[68]++;if((cov_1xyvq0qckk.b[16][0]++,requestedGameId.length)&&(cov_1xyvq0qckk.b[16][1]++,allGames[requestedGameId])){cov_1xyvq0qckk.b[15][0]++;cov_1xyvq0qckk.s[69]++;console.log('Room',requestedGameId,'is valid');var game=(cov_1xyvq0qckk.s[70]++,allGames[requestedGameId]);// Ensure that the same socket doesn't try to join the same game
// This can happen because we rewrite the browser's URL to reflect
// the new game ID, causing the view to reload.
// Also checking the number of players, so node doesn't crash when
// no one is in this custom room.
cov_1xyvq0qckk.s[71]++;if((cov_1xyvq0qckk.b[18][0]++,game.state==='awaiting players')&&((cov_1xyvq0qckk.b[18][1]++,!game.players.length)||(cov_1xyvq0qckk.b[18][2]++,game.players[0].socket.id!==socket.id))){cov_1xyvq0qckk.b[17][0]++;cov_1xyvq0qckk.s[72]++;// Put player into the requested game
console.log('Allowing player to join',requestedGameId);cov_1xyvq0qckk.s[73]++;allPlayers[socket.id]=true;cov_1xyvq0qckk.s[74]++;game.players.push(player);cov_1xyvq0qckk.s[75]++;socket.join(game.gameID);cov_1xyvq0qckk.s[76]++;socket.gameID=game.gameID;cov_1xyvq0qckk.s[77]++;game.assignPlayerColors();cov_1xyvq0qckk.s[78]++;game.assignGuestNames();cov_1xyvq0qckk.s[79]++;game.sendUpdate();cov_1xyvq0qckk.s[80]++;game.sendNotification(player.username+' has joined the game!');cov_1xyvq0qckk.s[81]++;if(game.players.length>=game.playerMaxLimit){cov_1xyvq0qckk.b[19][0]++;cov_1xyvq0qckk.s[82]++;gamesNeedingPlayers.shift();cov_1xyvq0qckk.s[83]++;game.prepareGame();}else{cov_1xyvq0qckk.b[19][1]++;}}else{// TODO: Send an error message back to this user saying the game has already started
cov_1xyvq0qckk.b[17][1]++;}}else{cov_1xyvq0qckk.b[15][1]++;cov_1xyvq0qckk.s[84]++;// Put players into the general queue
console.log('Redirecting player',socket.id,'to general queue');cov_1xyvq0qckk.s[85]++;if(createPrivate){cov_1xyvq0qckk.b[20][0]++;cov_1xyvq0qckk.s[86]++;createGameWithFriends(player,socket);}else{cov_1xyvq0qckk.b[20][1]++;cov_1xyvq0qckk.s[87]++;fireGame(player,socket);}}};cov_1xyvq0qckk.s[88]++;var fireGame=function(player,socket){cov_1xyvq0qckk.f[13]++;var game;cov_1xyvq0qckk.s[89]++;if(gamesNeedingPlayers.length<=0){cov_1xyvq0qckk.b[21][0]++;cov_1xyvq0qckk.s[90]++;gameID+=1;var gameIDStr=(cov_1xyvq0qckk.s[91]++,gameID.toString());cov_1xyvq0qckk.s[92]++;game=new Game(gameIDStr,io);cov_1xyvq0qckk.s[93]++;allPlayers[socket.id]=true;cov_1xyvq0qckk.s[94]++;game.players.push(player);cov_1xyvq0qckk.s[95]++;allGames[gameID]=game;cov_1xyvq0qckk.s[96]++;gamesNeedingPlayers.push(game);cov_1xyvq0qckk.s[97]++;socket.join(game.gameID);cov_1xyvq0qckk.s[98]++;socket.gameID=game.gameID;cov_1xyvq0qckk.s[99]++;console.log(socket.id,'has joined newly created game',game.gameID);cov_1xyvq0qckk.s[100]++;game.assignPlayerColors();cov_1xyvq0qckk.s[101]++;game.assignGuestNames();cov_1xyvq0qckk.s[102]++;game.sendUpdate();}else{cov_1xyvq0qckk.b[21][1]++;cov_1xyvq0qckk.s[103]++;game=gamesNeedingPlayers[0];cov_1xyvq0qckk.s[104]++;allPlayers[socket.id]=true;cov_1xyvq0qckk.s[105]++;game.players.push(player);cov_1xyvq0qckk.s[106]++;console.log(socket.id,'has joined game',game.gameID);cov_1xyvq0qckk.s[107]++;socket.join(game.gameID);cov_1xyvq0qckk.s[108]++;socket.gameID=game.gameID;cov_1xyvq0qckk.s[109]++;game.assignPlayerColors();cov_1xyvq0qckk.s[110]++;game.assignGuestNames();cov_1xyvq0qckk.s[111]++;game.sendUpdate();cov_1xyvq0qckk.s[112]++;game.sendNotification(player.username+' has joined the game!');cov_1xyvq0qckk.s[113]++;if(game.players.length>=game.playerMaxLimit){cov_1xyvq0qckk.b[22][0]++;cov_1xyvq0qckk.s[114]++;gamesNeedingPlayers.shift();cov_1xyvq0qckk.s[115]++;game.prepareGame();}else{cov_1xyvq0qckk.b[22][1]++;}}};cov_1xyvq0qckk.s[116]++;var createGameWithFriends=function(player,socket){cov_1xyvq0qckk.f[14]++;var isUniqueRoom=(cov_1xyvq0qckk.s[117]++,false);var uniqueRoom=(cov_1xyvq0qckk.s[118]++,'');// Generate a random 6-character game ID
cov_1xyvq0qckk.s[119]++;while(!isUniqueRoom){cov_1xyvq0qckk.s[120]++;uniqueRoom='';cov_1xyvq0qckk.s[121]++;for(var i=0;i<6;i++){cov_1xyvq0qckk.s[122]++;uniqueRoom+=chars[Math.floor(Math.random()*chars.length)];}cov_1xyvq0qckk.s[123]++;if((cov_1xyvq0qckk.b[24][0]++,!allGames[uniqueRoom])&&(cov_1xyvq0qckk.b[24][1]++,!/^\d+$/.test(uniqueRoom))){cov_1xyvq0qckk.b[23][0]++;cov_1xyvq0qckk.s[124]++;isUniqueRoom=true;}else{cov_1xyvq0qckk.b[23][1]++;}}cov_1xyvq0qckk.s[125]++;console.log(socket.id,'has created unique game',uniqueRoom);var game=(cov_1xyvq0qckk.s[126]++,new Game(uniqueRoom,io));cov_1xyvq0qckk.s[127]++;allPlayers[socket.id]=true;cov_1xyvq0qckk.s[128]++;game.players.push(player);cov_1xyvq0qckk.s[129]++;allGames[uniqueRoom]=game;cov_1xyvq0qckk.s[130]++;socket.join(game.gameID);cov_1xyvq0qckk.s[131]++;socket.gameID=game.gameID;cov_1xyvq0qckk.s[132]++;game.assignPlayerColors();cov_1xyvq0qckk.s[133]++;game.assignGuestNames();cov_1xyvq0qckk.s[134]++;game.sendUpdate();};cov_1xyvq0qckk.s[135]++;var exitGame=function(socket){cov_1xyvq0qckk.f[15]++;cov_1xyvq0qckk.s[136]++;console.log(socket.id,'has disconnected');cov_1xyvq0qckk.s[137]++;if(allGames[socket.gameID]){cov_1xyvq0qckk.b[25][0]++;// Make sure game exists
var game=(cov_1xyvq0qckk.s[138]++,allGames[socket.gameID]);cov_1xyvq0qckk.s[139]++;console.log(socket.id,'has left game',game.gameID);cov_1xyvq0qckk.s[140]++;delete allPlayers[socket.id];cov_1xyvq0qckk.s[141]++;if((cov_1xyvq0qckk.b[27][0]++,game.state==='awaiting players')||(cov_1xyvq0qckk.b[27][1]++,game.players.length-1>=game.playerMinLimit)){cov_1xyvq0qckk.b[26][0]++;cov_1xyvq0qckk.s[142]++;game.removePlayer(socket.id);}else{cov_1xyvq0qckk.b[26][1]++;cov_1xyvq0qckk.s[143]++;game.stateDissolveGame();cov_1xyvq0qckk.s[144]++;for(var j=0;j<game.players.length;j++){cov_1xyvq0qckk.s[145]++;game.players[j].socket.leave(socket.gameID);}cov_1xyvq0qckk.s[146]++;game.killGame();cov_1xyvq0qckk.s[147]++;delete allGames[socket.gameID];}}else{cov_1xyvq0qckk.b[25][1]++;}cov_1xyvq0qckk.s[148]++;socket.leave(socket.gameID);};};